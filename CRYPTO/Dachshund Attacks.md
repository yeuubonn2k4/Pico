## Description

What if `d is too small?` Connect with nc mercury.picoctf.net 62786.

## Solve

e: 49026395102000793766948795192180572669308771947487208307574629717168036949229882979752845712001393265136539322599220913388389604414848343845766749232915727377179567872720596821189621011903089860309457794509133714360441444501877043786433883407704904520528285644527147575191827410778095234435544294805193867441

n: 71075826709973884635892795845012505641758492272663620263011497836190714029026269547819973534158353834751444161646937427289528738392614711819660842536418207479974448756278423342739811067850469268215776638012215104959569771362606931786247379896936182253355865770434483570602576116437462045739343417801388624797

c: 21765781277562158934401159654782743539461517507958789290560915349710332366314126279614842656336025151561135266019820028129517945821083215586029089332157233833179734720653593155858062602070184942009300998395097344651724427414188727209165765279664643493590202683460853689037189835968971324528369267346185267032

import math
import decimal
D = decimal.Decimal

e = D(49026395102000793766948795192180572669308771947487208307574629717168036949229882979752845712001393265136539322599220913388389604414848343845766749232915727377179567872720596821189621011903089860309457794509133714360441444501877043786433883407704904520528285644527147575191827410778095234435544294805193867441)
N = D(71075826709973884635892795845012505641758492272663620263011497836190714029026269547819973534158353834751444161646937427289528738392614711819660842536418207479974448756278423342739811067850469268215776638012215104959569771362606931786247379896936182253355865770434483570602576116437462045739343417801388624797)
c_m = 21765781277562158934401159654782743539461517507958789290560915349710332366314126279614842656336025151561135266019820028129517945821083215586029089332157233833179734720653593155858062602070184942009300998395097344651724427414188727209165765279664643493590202683460853689037189835968971324528369267346185267032

#Continued fraction expansion of e/N (see https://en.wikipedia.org/wiki/Continued_fraction):
n_fe = e #nominator
d_fe = N #denominator
fraction_list = []

def expand_fraction_list(n_fe, d_fe):
    with decimal.localcontext() as ctx:
        ctx.prec = 350    
        cap = math.floor(n_fe/d_fe)
        rest = n_fe%d_fe
        fraction_list.append(cap)
        
        n_fe = d_fe
        d_fe = rest
    return (n_fe, d_fe)

def cfe(a_list, j): #Calculate fraction from fraction_list
    n_next = 0
    d_next = 1
    while j >= 0:
        d = d_next
        k = a_list[j]*d_next+n_next
        n_next = d
        d_next = k
        j = j-1
    return k,d #returns guess for k and d. d is the private key.




#Perform Wieners Attack (see https://en.wikipedia.org/wiki/Wiener%27s_attack)

n_fe, d_fe = expand_fraction_list(n_fe, d_fe) #creates 0th element in fraction list

for i in range(1,1000):   
    n_fe, d_fe = expand_fraction_list(n_fe, d_fe) #adds new element to fraction list
    k,d = cfe(fraction_list, i) #calculates the fraction for the i'th fraction expansion
    with decimal.localcontext() as ctx:
        ctx.prec = 10000
        PhiN = D((e*d-1)/k)
        if PhiN%1 == 0 and d%2 == 1: #Checks if phi(N) is a natural number and if d is odd
            with decimal.localcontext() as ctx: #try to solve square equation x2 + bx + c == 0
                ctx.prec = 1000
                b = -(N-PhiN+1)
                c = N
                sqr2 = b**2-4*c
                if sqr2 > 0: #checks if squareroot therm is larger than 0
                    sqr = D(sqr2.sqrt())
                    if sqr%1 == 0 and ((-b+sqr)/2)%1 == 0 and ((-b-sqr)/2)%1 == 0: #checks if squareroot-therm and the two solutions are all natural numbers
                        break

print("d = ", d)            

N = int(N)

m_c = pow(c_m, d, N)
print("Decrypted message: ", m_c)

from Crypto.Util.number import long_to_bytes
text = long_to_bytes(m_c)

print("Plain text: ", text)

![image](https://github.com/user-attachments/assets/5f4f7268-d4f0-4df7-b158-da40f5068966)

- Flag :

  `
  picoCTF{proving_wiener_5086186}
  `
